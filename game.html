<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>游戏页</title>
	<link href="css/hero.css" type="text/css" rel="stylesheet">
	<link rel="stylesheet" href="./webfonts/iconfont.css">
	<link href="css/text.css" type="text/css" rel="stylesheet">
	<link href="css/reasoning.css" type="text/css" rel="stylesheet">
	<link href="css/manual.css" type="text/css" rel="stylesheet">
	<link href="music-player/music-player.css" type="text/css" rel="stylesheet">
	<script language="javascript" src="js/jquery-1.8.3.min.js"></script>
	<style>
		*{
			margin:0;
		}
		::-webkit-scrollbar {
  			display: none;
		}
		/* 主要游戏窗口的设置 */
		.window{
			width:1000px;
			height:800px;
			position:absolute;
			background-color:black;
			top:50%;
			left:50%;
			transform:translate(-50%,-50%);
			/* border:30px solid;
			border-image: url(./img/edge.png) 27; */
			background-repeat:no-repeat;
			background-size: 1000px 800px;
			overflow:hidden;
		}
	</style>
	
	<!-- 游戏进度保存 -->
	<script>
		setTimeout(function(){
			$('.manual').fadeOut(500);
		},5000);
		var usr=localStorage.getItem('Hound_'+"CurrentPlayer");
		var archive_pointer=Number(localStorage.getItem('Hound_'+usr+'_archive_pointer'));
		function save_hint(text){
			if(text=='当前存档已满，已覆盖最早的现有存档！') $('.hint').css('width','300px');
			$('.hint').fadeIn(500);
			$('.hint').html(text);
			setTimeout(function(){
				$(".hint").fadeOut(2000);
				setTimeout(function(){
					if(text=='当前存档已满，已覆盖最早的现有存档！') $('.hint').css('width','200px');
				},2000);
			},1500);
		}
		function click_save(){
			if(archive_pointer>8){
				save_hint('当前存档已满，已覆盖最早的现有存档！');
				save('archive'+archive_pointer%9,archive_pointer%9+1);
			}
			else{
				save('archive'+archive_pointer,archive_pointer+1);
				save_hint('存档成功！');
			}
			archive_pointer++;
			localStorage.setItem('Hound_'+usr+'_archive_pointer',archive_pointer);
		}
	</script>
</head>
<!-- 游戏背景图片设置，有点丑陋目前 -->
<body style="background-image: url('./img/usbackground.jpg'); background-size: cover; background-position: center; background-repeat: repeat;">

	<div class="window">
		<div class="music-container" id="music-container">
			<audio src="./music-player/music/summer pocket.mp3" id="audio"></audio>
			<div class="navigation">
				<button id="prev" class="action-btn">
					<i class="iconfont icon-backward_fill"></i>
				</button>
				<button id="play" class="action-btn action-btn-big">
					<i class="iconfont icon-play_fill"></i>
				</button>
				<button id="next" class="action-btn">
					<i class="iconfont icon-play_forward_fill"></i>
				</button>
				<a id="currentMusic">CurrentMusic</a>
			</div>
		</div>
		<!-- <div class="auto-play-music"></div> -->
		<!-- <div id="coordHud" style="position:absolute; top:8px; left:8px; padding:4px 8px; background: rgba(0,0,0,0.6); color:#0f0; font: 12px/1 monospace; z-index: 99999; pointer-events:none;">X: -, Y: - | phase: -</div> -->
		<!-- 提供“继续游戏”、“保存游戏”和“退出游戏”三个选项。
		“继续游戏”按钮隐藏当前菜单。
		“保存游戏”按钮调用 click_save() 函数。
		“退出游戏”按钮重定向到主菜单页面。 -->
		<div class="option">
			<p>PAUSE</p>
			<ul type="none">
				<li><button onclick="option_now=0;$('.option').css('display','none')">继续游戏</button></li>
				<li><button onclick="click_save()">保存游戏</button></li>
				<li><button onclick="window.parent.postMessage('showMusicPlayer', '*');window.location.href = './home/home.html';">退出游戏</button></li>
			</ul>
		</div>
		<div class="achievement">
			<!-- 显示获得的成就，当前示例文本为“哈哈哈哈哈”。 -->
			<p>获得成就</p>
			<div id="achieve">哈哈哈哈哈</div>
		</div>
		<!-- 嵌入了小游戏的iframe。
		提供“退出”按钮，点击后隐藏小游戏界面并重置相关样式。 -->
		<div class="game1" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000;">

			<div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9); z-index: -1; pointer-events: none;"></div>
			<div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;">
				<iframe src="./minigame/game1/game.html" style="width:100%; height:90%; border: 0cm;"></iframe>
				<button onclick="$('.game1').css('display','none'),obj='none',$('.container').css('margin-top','0'),$('.container').css('margin-left','0')" style="font-size: 2em; padding: 10px 20px;">退出</button>
			</div>
		</div>

		<div class="game2" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000;">

			<div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9); z-index: -1; pointer-events: none;"></div>
			<div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;">
				<iframe src="./minigame/game2/game.html" style="width:100%; height:90%; border: 0cm;"></iframe>
				<button onclick="$('.game2').css('display','none'),obj='none',$('.container').css('margin-top','0'),$('.container').css('margin-left','0')" style="font-size: 2em; padding: 10px 20px;">退出</button>
			</div>
		</div>
		
		<div class="game3" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000;">

			<div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9); z-index: -1; pointer-events: none;"></div>
			<div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;">
				<iframe src="./minigame/game3/game.html" style="width:100%; height:90%; border: 0cm;"></iframe>
				<button onclick="$('.game3').css('display','none'),obj='none',$('.container').css('margin-top','0'),$('.container').css('margin-left','0')" style="font-size: 2em; padding: 10px 20px;">退出</button>
			</div>
		</div>

		<!-- 显示游戏操作指南，包括人物移动、物品交互、NPC对话等操作说明。 -->
		<div class="manual">
			<div style="margin-top:150px">
				<p>W,A,S,D:人物移动</p>
				<p>E:与NPC对话/进入下一个场景</p>
			</div>
		</div>
		<button id="skipCgButton" style="position: absolute; top: 10px; right: 10px; z-index: 1000000; background-color: rgba(0,0,0,0.5); color: white; padding: 10px 20px; cursor: pointer; display: none;">跳过CG</button>
		<!-- 显示游戏角色，设置了初始位置 -->
		<div class="hero" style="left:200px;top:200px;"></div>
		<!-- 显示游戏中的NPC角色。 -->
		<div class="npc" id="npc1"></div>
		<div class="npc" id="npc2"></div>
		<div class="npc" id="npc3"></div>
		<!-- 包含图片和文本容器，用于显示游戏中的对话和提示。 -->
		<div class="text">
			<div class="picture"></div>
			<div class="container">
				<div class="title"></div>
				<div class="texture"></div>
			</div>
			<div class="dialog_button"></div>
		</div>
		
		<!-- 提供两个个按钮，用于玩家进行对话选择。 -->
		<div class="choice_zone">
			<button id="choice1" onclick="choice(0)" style="margin-top:70px"></button><br>
			<button id="choice2" onclick="choice(1)" style="margin-top:30px"></button><br>
		</div>
		
		<!-- 用于显示游戏中的其他信息。 -->
		<div class="display"></div>
		<!-- 用于显示游戏中的提示信息。 -->
		<div class="hint"></div>

		<!-- 幕布 (<div class="curtain">)用于显示游戏中的背景和字幕。 -->
		<div class="curtain">
			<div class="background_board"></div>
			<div class="caption"></div>
		</div>
		
	</div>

	<script language="javascript" src="js/game_music.js"></script> 
	<script language="javascript" src="js/archive.js"></script>
	<script language="javascript" src="js/patch.js"></script>
	<script language="javascript" src="js/init.js"></script>
	<script language="javascript" src="js/clue.js"></script>
	<script language="javascript" src="js/npc.js"></script>	
	<script language="javascript" src="js/hurdle.js"></script>
	<script language="javascript" src="js/map.js"></script>
	<script language="javascript" src="js/interact.js"></script>
	<script language="javascript" src="js/end.js"></script>
	<script language="javascript" src="js/startgame.js"></script>
	<script language="javascript" src="js/object.js"></script>

	<style>
		#myImage {
			position: fixed; /* 固定位置 */
			top: 50%; /* 垂直居中 */
			left: 50%; /* 水平居中 */
			transform: translate(-50%, -50%); /* 调整偏移量以实现真正的居中 */
			z-index: 1000; /* 置于最顶层 */
			display: none; /* 保持隐藏状态，除非通过JavaScript显示 */
		}
	</style>
	<img id="myImage" src="" style="display: none;" />

    <script>
    // 添加点击事件监听器，点击游戏页面时重新获取焦点
    document.addEventListener('click', function() {
        // 确保游戏窗口获得焦点
        window.focus();
    });
    
    // 添加鼠标进入事件监听器
    document.addEventListener('mouseenter', function() {
        // 确保游戏窗口获得焦点
        window.focus();
    });
    </script>
	
	<script>
		window.addEventListener('message', function(event) {
			// 检查消息的来源，确保是来自预期的子 iframe
			// 在文件系统环境下，源通常是 'null'
			// if (event.origin !== 'null' && event.origin !== 'file://') {
			//     return; // 忽略来自未知源的消息
			// }

			if (event.data === 'win_game1') {
				old_knight = 7;
			} else if (event.data === 'lose_game1') {
				old_knight = 8;
			}
		});
	</script>
	<!-- 游戏内的音乐播放器，与主页不同 -->
</body>

</html>